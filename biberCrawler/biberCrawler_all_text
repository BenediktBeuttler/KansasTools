from bs4 import BeautifulSoup
import requests
import codecs
import re

basePath = "biberCrawler"
metaFileName = basePath + "/bibermeta.csv"
# Variables which have the same value for all articles
biberLizenz = 'unknown'
encoding = "utf-8"
author = 'dasBiber'
org = 'dasBiber'# 
orgLink = 'https://www.dasbiber.at/'
logs = 'logs.txt'  # Define logs file path

r = requests.get("https://www.dasbiber.at/content/optimal-vorbereitet-auf-die-karriere-der-gesundheits-und-krankenpflege")
data = r.text
soup = BeautifulSoup(data, features="html.parser")

# Method to append meta data to bibermeta.csv
def addToMetaFile(fileName, url, title, author, org, orgLink):
    with codecs.open(metaFileName, 'a', encoding) as f:
        f.write(f'{fileName}\t{title}\t{url}\t\t{biberLizenz}\t{author}\t\t{org}\t{orgLink}\n')
        f.close()

    logIt(str("added to Meta - " + title))

# Function to log URLs
def logIt(text):
    with codecs.open(logs, 'a', encoding) as f:
        f.write(text+ "\n")
        f.close()
    print(text)

# Crawling method
def crawl_page():
     r = requests.get('https://www.dasbiber.at/content/optimal-vorbereitet-auf-die-karriere-der-gesundheits-und-krankenpflege')
     data = r.text
     soup = BeautifulSoup(data, features="html.parser")
     
     meta_title = soup.title
     meta_title = meta_title.string 
     meta_title = meta_title[:-11]
     print(meta_title)
     fileName = meta_title.replace(" ", "") + '.txt'
     print(fileName)
     
     baseUrl = 'https://www.dasbiber.at/content/'
     url = (soup.find('link', rel=re.compile('canonical'))['href']) 
     
     logIt(url)
     addToMetaFile(fileName, url, meta_title, author, org, orgLink)



def crawlNormalText(soup):
    #printed text inkl. Bildunterschriften und "*BEZAHLTE ANZEIGE"
    text = ""
    parent = soup.find("div", {"class":"node-content"}) #find all tags, safe them in container
    print("find method compared with get_text()"+ parent.get_text()) #gets all text also from inner tags. 




# Calling the crawl_page function
#crawl_page()
crawlNormalText(soup)


